resource "azurerm_virtual_machine_extension" "IaaSAntimalware" {
  count                      = var.enable_iaasantimalware_extension ? 1 : 0
  name                       = "IaaSAntimalware"
  virtual_machine_id         = azurerm_windows_virtual_machine.main.id
  publisher                  = "Microsoft.Azure.Security"
  type                       = "IaaSAntimalware"
  type_handler_version       = "1.3"
  auto_upgrade_minor_version = true

  settings = <<SETTINGS
    {
        "AntimalwareEnabled": "true",
        "RealtimeProtectionEnabled": "true"
    }
    SETTINGS

  depends_on = [
    azurerm_virtual_machine_extension.ADE
  ]

  tags = var.tags

}